<div class="mx-4 mt-4">
  <p-card>
    <p-table
      #pTable
      [value]="store.beds()"
      [lazy]="true"
      (onLazyLoad)="loadBeds($event)"
      [paginator]="true"
      [rows]="5"
      [first]="store.first()"
      [totalRecords]="store.total()"
      [loading]="store.isLoading()"
      [rowsPerPageOptions]="[5, 10, 20]"
      dataKey="id"
      stripedRows
      styleClass="rounded-lg"
      selectionMode="single"
      [selection]="store.selectedBed()"
      (selectionChange)="store.selectBed($event)"
      styleClass=""
    >
      <ng-template pTemplate="caption">
        <div class="flex justify-end align-items-center gap-4">
          <p-button
            label="Insert Bed"
            icon="pi pi-plus"
            shortcut="alt.i"
            (click)="showAddDialog()"
          ></p-button>

          <p-button
            label="Delete"
            icon="pi pi-trash"
            severity="danger"
            shortcut="alt.d"
            (click)="confirmDelete()"
            [disabled]="!store.isBedSelected()"
          ></p-button>
        </div>
      </ng-template>
      <ng-template pTemplate="header">
        <tr>
          <th style="width: 5rem">#</th>
          <th>Name</th>
          <th>Area</th>
          <th>Section</th>
          <th>Bed ID</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-bed let-rowIndex="rowIndex">
        <tr [pSelectableRow]="bed">
          <!-- The rowIndex gives us the order number for the current page -->
          <td>{{ rowIndex + 1 }}</td>
          <td>{{ bed.name }}</td>
          <td>{{ bed.area }}</td>
          <td>{{ bed.section }}</td>
          <td>{{ bed.id }}</td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="5">No beds found.</td>
        </tr>
      </ng-template>
    </p-table>
  </p-card>

</div>

<!-- Add Bed Dialog -->
<p-dialog header="Add a New Bed" draggable="false" [(visible)]="isAddDialogVisible" [modal]="true">
  <!-- <form class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4" [formGroup]="bedForm" (ngSubmit)="saveNewBed()">
    <app-custom-input
      label="Data Source"
      placeholder="e.g., NOAA"
      type="text"
      formControlName="name"
    ></app-custom-input>

    <app-custom-input
      label="Data Source"
      placeholder="e.g., NOAA"
      type="text"
      formControlName="area"
    ></app-custom-input>

    <app-custom-input
      label="Data Source"
      placeholder="e.g., NOAA"
      type="number"
      formControlName="section"
      [errorMessages]="{ noNegative: 'Anomaly cannot be a negative number.' }"
    ></app-custom-input>

   <div class="md:col-span-2">
      <p-button
        label="Cancel"
        shortcut="alt.c"
        severity="secondary"
        (click)="isAddDialogVisible = false"
      ></p-button>
      <p-button
        type="submit"
        label="Save"
        shortcut="alt.s"
        [disabled]="bedForm.invalid"
        [loading]="store.isLoading()"
      ></p-button>
    </div>
  </form> -->

  <form class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4" [formGroup]="bedForm" (ngSubmit)="saveNewBed()">

  <!-- Bed Name Input -->
  <app-custom-input
    label="Bed Name"
    placeholder="e.g., Rose Garden Section A"
    type="text"
    formControlName="name"
    [errorMessages]="{ required: 'The bed name is required.' }"
  ></app-custom-input>

  <!-- Area Input (Number) -->
  <app-custom-input
    label="Area"
    placeholder=""
    type="number"
    formControlName="area"
    [errorMessages]="{ 
      required: 'The area is required.',
      noNegative: 'Area cannot be a negative value.'
    }"
  ></app-custom-input>
  
  <!-- Section Input (Text with minlength) -->
  <app-custom-input
    label="Section Code"
    placeholder="e.g., NORTH-1"
    type="text"
    formControlName="section"
    [errorMessages]="{ 
      required: 'The section code is required.',
      minlength: 'Section code must be at least 3 characters long.'
    }"
    [toastErrors]="{ 
      minlength: { severity: 'warn', summary: 'Input Too Short' } 
    }"
  ></app-custom-input>
  
  <!-- Form Actions (e.g., Save and Cancel buttons) -->
  <div class="flex justify-end gap-2 mt-4">
    <button
      pButton
      pRipple
      type="button" 
      label="Cancel" 
      class="p-button-secondary" 
      (click)="isAddDialogVisible = false"
    ></button>
    <button
      pButton
      pRipple
      type="submit" 
      label="Save Bed" 
      class="p-button-success" 
      icon="pi pi-check"
      [disabled]="bedForm.invalid"
    ></button>
  </div>

</form>
</p-dialog>

<div>
  <p-confirmDialog #cd key="delete-bed-confirmation" [style]="{ width: '450px' }">
    <ng-template pTemplate="footer">
      <div class="flex justify-end gap-2">
        <!-- The Cancel (Reject) Button -->
        <button
          pButton
          type="button"
          label="Cancel"
          severity="secondary"
          outlined="true"
          shortcut="alt.c"
          (click)="cd.onReject()"
        ></button>

        <!-- The Delete (Accept) Button -->
        <button
          pButton
          type="button"
          label="Delete"
          severity="danger"
          shortcut="alt.d"
          (click)="cd.onAccept()"
        ></button>
      </div>
    </ng-template>
  </p-confirmDialog>
</div>
